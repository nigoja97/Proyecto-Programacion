---
title: "Segunda Entrega del Proyecto"
date: "28/3/2021"
output:
  pdf_document: default
  html_document:
    df_print: paged
---

# **Buen desempeño económico, la clave del éxito para un rendimiento sobresaliente en los juegos olímpicos.**

### **1.** Integrantes de grupo.

-   *Nicolas González*

-   *Joan Galeano*

-   *Alejandro Guevara*



### Paquetes

```{r}
library(tidyverse)
library(rvest)
library(haven)
library(wbstats)
library(dplyr)
library(naniar)
library(knitr)
library(ggthemes)
library(readxl)
library(GGally)
library(Hmisc)
library(corrplot)
install.packages("PerformanceAnalytics")
library(PerformanceAnalytics)
```

### Manejo de la base de datos

### Variable explicada

```{r}
pagina <-"http://www.olympedia.org/statistics/medal/country"
pagina_desc <- read_html(pagina)

paises <- pagina_desc %>% html_nodes("td:nth-child(1)") %>% html_text() 

medallas <- pagina_desc %>% html_nodes("td:nth-child(6)") %>% html_text()
medallas <- as.integer(medallas)
medallas_por_pais <- tibble(paises, medallas)
```

### Variables explicativas

En este caso, se presenta la Tasa de crecimiento del PIB como primera variable explicativa. 

```{r}
growth_gdp <- wb_data("NY.GDP.PCAP.KD.ZG", start_date = 1950, end_date = 2016)
growth_gdp <- tibble(growth_gdp$country,growth_gdp$date,growth_gdp$NY.GDP.PCAP.KD.ZG)
growth_gdp <- growth_gdp %>% 
  rename(
    paises = `growth_gdp$country`,
    fecha = `growth_gdp$date`,
    growth = `growth_gdp$NY.GDP.PCAP.KD.ZG`
      )
growth_gdp <- drop_na(growth_gdp)

growth_gdp_prom <- aggregate(growth_gdp$growth, list(growth_gdp$paises), FUN=mean)
growth_gdp_prom <- growth_gdp_prom %>%
  rename(
    paises = Group.1, GDP=x
    )
```

A continuación, se usará la Tasa de crecimiento de la población. 

```{r}
growth_pob <- wb_data("SP.POP.GROW", start_date = 1950, end_date = 2016)
growth_pob <- tibble(growth_pob$country,growth_pob$date,growth_pob$SP.POP.GROW)
growth_pob <- growth_pob %>% 
  rename(
    paises = "growth_pob$country",
    fecha ="growth_pob$date",
    growth_p ="growth_pob$SP.POP.GROW"
      )
growth_pob <-drop_na(growth_pob)

growth_pob_prom <- aggregate(growth_pob$growth_p, list(growth_pob$paises), FUN=mean)
growth_pob_prom <- growth_pob_prom %>%
  rename(
    paises = Group.1, crecimiento=x
    )
```

También se decidió incluir la Tasa promedio de paro.

```{r}
desempleo_total <- wb_data("SL.UEM.TOTL.ZS", start_date = 1950, end_date = 2016)
desempleo_total <- tibble(desempleo_total$country,desempleo_total$date,desempleo_total$SL.UEM.TOTL.ZS)
desempleo_total <-desempleo_total%>% 
  rename(
    paises = "desempleo_total$country",
    fecha ="desempleo_total$date",
    desempleo_t ="desempleo_total$SL.UEM.TOTL.ZS"
      )
desempleo_total
desempleo_total <-drop_na(desempleo_total)
desempleo_total_prom <- aggregate(desempleo_total$desempleo_t, list(desempleo_total$paises), FUN=mean)
desempleo_total_prom <- desempleo_total_prom %>%
  rename(
    paises = Group.1, DESP=x
    )
```

Se incluirá la Tasa promedio de inflación para explicar su efecto parcial sobre el desempeño deportivo en los juegos olímpicos. 

```{r}
inflacion <- wb_data("NY.GDP.DEFL.KD.ZG", start_date = 1950, end_date = 2016)
inflacion<- tibble(inflacion$country,inflacion$date,inflacion$NY.GDP.DEFL.KD.ZG)
inflacion <- inflacion %>% 
  rename(
    paises = "inflacion$country",
    fecha = "inflacion$date",
   inflacion_t ="inflacion$NY.GDP.DEFL.KD.ZG"
      )
inflacion
inflacion <- drop_na(inflacion)

inflacion_prom <- aggregate(inflacion$inflacion_t, list(inflacion$paises), FUN=mean)
inflacion_prom <-inflacion_prom %>%
  rename(
    paises = Group.1,INF=x
    )
```

Finalmente, se hace un proceso de adjunción de todas las variables en un mismo objeto. 

```{r}
datos <- left_join(medallas_por_pais, growth_pob_prom,by = "paises")
View(datos)
datos1 <- left_join(datos, growth_gdp_prom,by = "paises")
View(datos1)
datos2 <- left_join(datos1, desempleo_total_prom,by = "paises")
View(datos2)
tidy_data<- left_join(datos2, inflacion_prom,by = "paises")
View(tidy_data)

loop <- as.data.frame(tidy_data)
for (i in tidy_data) {
  print(class(i))
}
```
###Punto6
```{r}
tidy_data %>% 
  group_by(paises,medallas) %>%
  head(15)%>%
ggplot(aes(x=reorder(paises,medallas),y=medallas, fill=paises)) +
geom_col() + coord_flip() +  labs(title = "Total de medallas ganadas", x= "Países", y= "Medallas")+
theme_solarized_2()  + scale_colour_solarized('green')+theme(text = element_text(family = "serif"), 
plot.title = element_text(face = "bold.italic", hjust = 0.5))+  theme(legend.position = "bottom")+theme(legend.background = element_rect(fill="lavenderblush2",size=0.5, linetype="solid", colour ="lightsalmon3"))
```

###punto 7
```{r}
cor(tidy_data$Crecimiento, tidy_data$GDP, use = "complete.obs")
cor(tidy_data$Crecimiento, tidy_data$DESP, use = "complete.obs")
cor(tidy_data$Crecimiento, tidy_data$INF, use = "complete.obs")

ggpairs(tidy_data, columns = 3:6, method = c("everything", "pearson"),title="Correlograma",color="red")+theme_solarized_2()  + scale_colour_solarized('green')+theme(text = element_text(family = "serif"), 
plot.title = element_text(face = "bold.italic", hjust = 0.5))+  theme(legend.position = "bottom")+theme(legend.background = element_rect(fill="lavenderblush2",size=0.5, linetype="solid", colour ="lightsalmon3"))

```
